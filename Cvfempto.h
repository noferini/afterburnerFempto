#ifndef CVFEMPTO
#define CVFEMPTO

#include "Cutils.h"
#include "TH1F.h"

class vfempto
{
  public:
    virtual double doInteract(particleMC& p1, particleMC& p2, float chargeColoumb, float chargeStrong, float sumRadii = 0, float *pos=nullptr, float *posLab=nullptr); // perform interaction and return momentum exchanged
    bool isCoalescence(const particleMC& p1, const particleMC& p2, int step=0);
    virtual float getCoalProb(const particleMC& p1, const particleMC& p2);
    virtual bool set(particleMC& p1, particleMC& p2, float chargeColoumb, float chargeStrong) { return true; }
    virtual void doInteractAll(std::vector<particleMC>& part, bool doScattering = true, bool doCoal = true);
    virtual void doInteractAllStep(int step, std::vector<particleMC>& part, bool doScattering = true, bool doCoal = true);
    virtual void init() { mIsInitialized = true; };
    virtual void setThreshold(double threshold){mThreshold = threshold;}

    virtual void setParams(float strong=2.2E-3, float strongR=2.4, float coloumb=1.44E-3, float sourceRadius=0, float spinFact=3./8) { mStrong = strong, mStrongR = strongR, mCoulomb = coloumb, mSourceRadius = sourceRadius, mSpinCoalFactor = spinFact; }
    float getStrong() const { return mStrong; }
    float getStrongRadius() const { return mStrongR; }
    float getColoumb() const { return mCoulomb; }
    float getSourceRadius() const { return mSourceRadius; }
    TH1F* getHistoGroup() { return mHsizeGroup; }
    TH1F* getHistoMerge() { return mHsizeMerge; }
    int getNmaxSteps() const { return mNmaxSteps; }
    void setNmaxSteps(int val) { mNmaxSteps = val; }
  protected:
    float mStrong = 2.2E-3;      // attractive potential
    float mStrongR = 2.4;        // radius of box potential
    float mCoulomb = 1.44E-3;
    float mSourceRadius = 0;
    float mSpinCoalFactor = 3./8;
    bool mIsInitialized = false;
    double mThreshold = 0.4;
    int mNmaxSteps = 3;
    particleMC merge(const particleMC& p1, const particleMC& p2, particleMC& photon);

  private:
    TH1F *mHsizeGroup = nullptr;
    TH1F *mHsizeMerge = nullptr;
};

#endif

